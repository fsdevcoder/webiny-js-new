name: webiny-cms-project

components:
  function: '../../../node_modules/@webiny/serverless-function'
  cdn: '/Users/paveldenisjuk/webiny/js/aws-cloudfront'

vars:
  env:
    WEBINY_JWT_SECRET: ${env.WEBINY_JWT_SECRET}
  database:
    server: ${env.MONGODB_SERVER}
    name: ${env.MONGODB_NAME}

gateway:
  component: "@webiny/serverless-apollo-gateway"
  inputs:
    name: gateway
    services:
      - name: security
        url: ${security.api.url}/graphql
      - name: files
        url: ${files.api.url}/graphql
      - name: pageBuilder
        url: ${pageBuilder.api.url}/graphql

security:
  component: "@webiny/serverless-apollo-service"
  inputs:
    name: security
    database: ${vars.database}
    env: ${vars.env}
    plugins:
      - "@webiny/api-security/plugins"

# Example of a custom service using generic component
files:
  component: "@webiny/serverless-apollo-service"
  inputs:
    name: files
    database: ${vars.database}
    env: ${vars.env}
    plugins:
      - "@webiny/api-files/plugins"

# Example of a specific use-case component
pageBuilder:
  component: "@webiny/serverless-page-builder"
  inputs:
    name: pageBuilder
    database: ${vars.database}
    env: ${vars.env}
    plugins:
      - "@webiny/api-google-tag-manager"
      - "@webiny/api-mailchimp"
      - "@webiny/api-cookie-policy"

api:
  component: "@serverless/aws-api-gateway"
  inputs:
    description: "Main GraphQL API"
    stage: prod
    endpointTypes: ['REGIONAL']
    endpoints:
      - path: /graphql
        method: ANY
        function: ${gateway.arn}

#cdn:
#  component: ${components.cdn}
#  inputs:
#    origins:
#      - ${files.cdnOrigin}
#      - url: ${api.url}
#        pathPatterns:
#          "/graphql":
#            ttl: 0
#            forward:
#              headers: ["Accept", "Accept-Language"]
#            allowedHttpMethods: ["GET", "HEAD", "OPTIONS", "PUT", "POST", "PATCH", "DELETE"]
