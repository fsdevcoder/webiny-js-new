{"version":3,"sources":["../src/routerMiddleware.js"],"names":["loadPage","query","graphql","variables","url","then","data","loadPageByUrl","params","next","finish","route","match","path","output","JSON","stringify"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;AACA;;;;;;kBAEe,YAAM;AACjB,QAAMA,WAAW,SAAXA,QAAW,MAAO;AACpB,YAAMC,kDAAN;;AAcA,eAAO,eAAIC,OAAJ,CAAYD,KAAZ,CAAkB,EAAEA,YAAF,EAASE,WAAW,EAAEC,QAAF,EAApB,EAAlB,EAAiDC,IAAjD,CAAsD,gBAAc;AAAA,gBAAXC,IAAW,QAAXA,IAAW;;AACvE,mBAAOA,KAAKC,aAAZ;AACH,SAFM,CAAP;AAGH,KAlBD;;AAoBA;AAAA,6FAAO,iBAAOC,MAAP,EAAeC,IAAf,EAAqBC,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AACH;AACQC,iCAFL,GAEsBH,MAFtB,CAEKG,KAFL,EAEYC,KAFZ,GAEsBJ,MAFtB,CAEYI,KAFZ;;AAAA,kCAICD,MAAME,IAAN,KAAe,GAJhB;AAAA;AAAA;AAAA;;AAAA,6DAKQb,SAASY,MAAMR,GAAf,EAAoBC,IAApB,CAAyB,gBAAQ;AACpCG,uCAAOM,MAAP,GACI;AAAA;AAAA;AACI;AAAA;AAAA;AAAA;AAAA,qCADJ;AAEI;AAAA;AAAA;AAAIF,8CAAMR;AAAV,qCAFJ;AAGI;AAAA;AAAA;AAAMW,6CAAKC,SAAL,CAAeV,IAAf,EAAqB,IAArB,EAA2B,CAA3B;AAAN;AAHJ,iCADJ;AAOAI,uCAAOF,MAAP;AACH,6BATM,CALR;;AAAA;;AAiBHC;;AAjBG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAP;;AAAA;AAAA;AAAA;AAAA;AAmBH,C","file":"routerMiddleware.js","sourcesContent":["import React from \"react\";\nimport { app } from \"webiny-app\";\nimport gql from \"graphql-tag\";\n\nexport default () => {\n    const loadPage = url => {\n        const query = gql`\n            query LoadPage($url: String!) {\n                loadPageByUrl(url: $url) {\n                    id\n                    title\n                    slug\n                    content {\n                        type\n                        data\n                    }\n                }\n            }\n        `;\n\n        return app.graphql.query({ query, variables: { url } }).then(({ data }) => {\n            return data.loadPageByUrl;\n        });\n    };\n\n    return async (params, next, finish) => {\n        // CMS middleware\n        const { route, match } = params;\n\n        if (route.path === \"*\") {\n            return loadPage(match.url).then(data => {\n                params.output = (\n                    <div>\n                        <h2>CMS WILL RENDER....</h2>\n                        <p>{match.url}</p>\n                        <pre>{JSON.stringify(data, null, 2)}</pre>\n                    </div>\n                );\n                finish(params);\n            });\n        }\n\n        next();\n    };\n};\n"]}