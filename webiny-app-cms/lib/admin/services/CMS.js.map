{"version":3,"sources":["../../../src/admin/services/CMS.js"],"names":["CMS","widgets","widgetGroups","editorWidgets","layoutEditorWidgets","group","push","widget","type","filter","w","extraFilters","data","createWidget","app","graphql","generateCreate","variables","then","id","widgetDefinition","getEditorWidget","addEditorWidget","origin","updateWidget","generateUpdate","index","deleteWidget","generateDelete","splice"],"mappings":"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","file":"CMS.js","sourcesContent":["// @flow\nimport _ from \"lodash\";\nimport { app } from \"webiny-app\";\nimport type { Widget, EditorWidget } from \"webiny-app-cms\";\n\nexport type WidgetGroup = {\n    name: string,\n    title: string,\n    icon: string | Array<string>\n};\n\nexport type WidgetData = {\n    type: string,\n    group: string,\n    title: string,\n    icon: string | Array<string>,\n    widget: EditorWidget\n};\n\nexport type LayoutWidgetData = {\n    type: string,\n    widget: EditorWidget\n};\n\nclass CMS {\n    /**\n     * @private\n     */\n    widgets: Array<Widget>;\n\n    /**\n     * @private\n     */\n    widgetGroups: Array<WidgetGroup>;\n\n    /**\n     * @private\n     */\n    editorWidgets: Array<WidgetData>;\n\n    /**\n     * @private\n     */\n    layoutEditorWidgets: Array<LayoutWidgetData>;\n\n    constructor() {\n        this.widgets = [];\n        this.widgetGroups = [];\n        this.editorWidgets = [];\n        this.layoutEditorWidgets = [];\n    }\n\n    addWidgetGroup(group: WidgetGroup) {\n        this.widgetGroups.push(group);\n    }\n\n    addEditorWidget(widget: WidgetData) {\n        this.editorWidgets.push(widget);\n    }\n\n    addLayoutEditorWidget(widget: LayoutWidgetData) {\n        this.layoutEditorWidgets.push(widget);\n    }\n\n    addWidget(widget: Widget) {\n        this.widgets.push(widget);\n    }\n\n    getWidget(type: string) {\n        return _.find(this.widgets, { type });\n    }\n\n    getWidgetGroups() {\n        return this.widgetGroups;\n    }\n\n    getEditorWidgets(group: ?string) {\n        return group ? this.editorWidgets.filter(w => w.group === group) : this.editorWidgets;\n    }\n\n    getEditorWidget(type: string, extraFilters: Object = {}) {\n        return _.find(this.editorWidgets, { type, ...extraFilters });\n    }\n\n    getLayoutEditorWidgets() {\n        return this.layoutEditorWidgets;\n    }\n\n    getLayoutEditorWidget(type: string, filter: Object = {}) {\n        return _.find(this.layoutEditorWidgets, { type, ...filter });\n    }\n\n    createGlobalWidget(data: Object) {\n        const createWidget = app.graphql.generateCreate(\"CmsWidget\", \"id\");\n        return createWidget({ variables: { data } }).then(({ data: { id } }) => {\n            // Register new global widget\n            const widgetDefinition = this.getEditorWidget(data.type);\n            this.addEditorWidget({\n                type: \"global\",\n                ..._.cloneDeep(widgetDefinition),\n                ...data,\n                origin: id\n            });\n\n            return id;\n        });\n    }\n\n    updateGlobalWidget(id: string, data: Object) {\n        const updateWidget = app.graphql.generateUpdate(\"CmsWidget\", \"id\");\n        return updateWidget({ variables: { id, data } }).then(() => {\n            // Register new global widget\n            const index = _.findIndex(this.editorWidgets, { group: \"global\", origin: id });\n            this.editorWidgets[index] = {\n                ...this.editorWidgets[index],\n                ...data\n            };\n        });\n    }\n\n    deleteGlobalWidget(id: string) {\n        const deleteWidget = app.graphql.generateDelete(\"CmsWidget\", \"id\");\n        return deleteWidget({ variables: { id } }).then(() => {\n            const index = _.findIndex(this.editorWidgets, { group: \"global\", origin: id });\n            this.editorWidgets.splice(index, 1);\n        });\n    }\n}\n\nexport default CMS;\n"]}