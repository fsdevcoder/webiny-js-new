{"version":3,"sources":["../../src/render/pageRenderer.js"],"names":["defaultWidgetRender","widget","cms","app","services","get","widgetDefinition","getWidget","type","React","cloneElement","render","defaultWidgetRenderMiddleware","params","next","output","createRenderer","widgetRender","config","widgetRenderMiddleware","data","content","i","length","widgetParams","page","push","key","id"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA;;;AAGA,IAAMA,sBAAsB,SAAtBA,mBAAsB,OAAgB;AAAA,QAAbC,MAAa,QAAbA,MAAa;;AACxC,QAAMC,MAAMC,eAAIC,QAAJ,CAAaC,GAAb,CAAiB,KAAjB,CAAZ;;AAEA,QAAMC,mBAAmBJ,IAAIK,SAAJ,CAAcN,OAAOO,IAArB,CAAzB;AACA,6BAAUF,gBAAV,4CAAmEL,OAAOO,IAA1E;;AAEA,WAAOC,gBAAMC,YAAN,CAAmBJ,iBAAiBL,MAAjB,CAAwBU,MAAxB,CAA+BV,MAA/B,CAAnB,EAA2D,EAAEA,cAAF,EAA3D,CAAP;AACH,CAPD;;AASA;;;;AAIA,IAAMW,gCAAgC,SAAhCA,6BAAgC,CAACC,MAAD,EAAiBC,IAAjB,EAAoC;AACtE,QAAID,OAAOE,MAAX,EAAmB;AACf,eAAOD,MAAP;AACH;AACDD,WAAOE,MAAP,GAAgBf,oBAAoBa,MAApB,CAAhB;AACAC;AACH,CAND;;AAQA;;;;;AAKO,IAAME,0CAAiB,SAAjBA,cAAiB,SAAU;AACpC,QAAMC,eAAeC,OAAOjB,MAAP,IAAiB,EAAtC;AACA,QAAMkB,yBAAyB,wEAAYF,YAAZ,IAA0BL,6BAA1B,GAA/B;;AAEA;AAAA,6FAAO,iBAAMQ,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AACGC,mCADH,GACa,EADb;AAEMC,6BAFN,GAEU,CAFV;;AAAA;AAAA,kCAEaA,IAAIF,KAAKC,OAAL,CAAaE,MAF9B;AAAA;AAAA;AAAA;;AAGOC,wCAHP,GAGsB;AACjBC,sCAAML,IADW;AAEjBnB,wCAAQmB,KAAKC,OAAL,CAAaC,CAAb,CAFS;AAGjBP,wCAAQ,IAHS;AAIjBf;AAJiB,6BAHtB;AAAA;AAAA,mCASOmB,uBAAuBK,YAAvB,CATP;;AAAA;AAUST,kCAVT,GAUoBS,YAVpB,CAUST,MAVT;AAWC;;AACAM,oCAAQK,IAAR,CAAajB,gBAAMC,YAAN,CAAmBK,MAAnB,EAA2B,EAAEY,KAAKP,KAAKC,OAAL,CAAaC,CAAb,EAAgBM,EAAvB,EAA3B,CAAb;;AAZD;AAEsCN,+BAFtC;AAAA;AAAA;;AAAA;AAAA,6DAcI;AAAC,8CAAD;AAAA,kCAAM,MAAMF,IAAZ;AAAmBC;AAAnB,6BAdJ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAP;;AAAA;AAAA;AAAA;AAAA;AAgBH,CApBM","file":"pageRenderer.js","sourcesContent":["import React from \"react\";\nimport invariant from \"invariant\";\nimport compose from \"webiny-compose\";\nimport { app } from \"webiny-app\";\nimport Page from \"./Page\";\n\n/**\n * Default logic for single widget rendering.\n */\nconst defaultWidgetRender = ({ widget }) => {\n    const cms = app.services.get(\"cms\");\n\n    const widgetDefinition = cms.getWidget(widget.type);\n    invariant(widgetDefinition, `Missing widget definition for type \"${widget.type}\"`);\n\n    return React.cloneElement(widgetDefinition.widget.render(widget), { widget });\n};\n\n/**\n * Default middleware for rendering of page widgets.\n * It will not render anything if there already is an output assigned by previous middleware.\n */\nconst defaultWidgetRenderMiddleware = (params: Object, next: Function) => {\n    if (params.output) {\n        return next();\n    }\n    params.output = defaultWidgetRender(params);\n    next();\n};\n\n/**\n * Page renderer factory\n * @param config\n * @returns {Function}\n */\nexport const createRenderer = config => {\n    const widgetRender = config.widget || [];\n    const widgetRenderMiddleware = compose([...widgetRender, defaultWidgetRenderMiddleware]);\n\n    return async data => {\n        const content = [];\n        for (let i = 0; i < data.content.length; i++) {\n            const widgetParams = {\n                page: data,\n                widget: data.content[i],\n                output: null,\n                defaultWidgetRender\n            };\n            await widgetRenderMiddleware(widgetParams);\n            const { output } = widgetParams;\n            // $FlowIgnore\n            content.push(React.cloneElement(output, { key: data.content[i].id }));\n        }\n        return <Page page={data}>{content}</Page>;\n    };\n};\n"]}