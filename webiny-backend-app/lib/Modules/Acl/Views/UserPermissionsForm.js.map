{"version":3,"sources":["../../../../src/Modules/Acl/Views/UserPermissionsForm.jsx"],"names":["UserPermissionsForm","props","state","model","form","classId","method","pIndex","findIndex","permissions","rules","set","get","setState","resource","push","splice","Ui","newUserPermission","Router","getParams","i18n","permission","name","id","onToggle","onAdd","onRemove","cancel","submit","View","defaultProps","renderer","renderView"],"mappings":"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","file":"UserPermissionsForm.js","sourcesContent":["import React from 'react';\nimport _ from 'lodash';\nimport {Webiny} from 'webiny-client';\nimport EntityPermissions from './Components/EntityPermissions';\nimport ServicePermissions from './Components/ServicePermissions';\n\n/**\n * @i18n.namespace Webiny.Backend.Acl.UserPermissionsForm\n */\nclass UserPermissionsForm extends Webiny.Ui.View {\n    constructor(props) {\n        super(props);\n        this.state = {};\n    }\n\n    onToggle(model, form, classId, method) {\n        const pIndex = _.findIndex(model.permissions, {classId});\n\n        const rules = model.permissions[pIndex].rules;\n        _.set(rules, method, !_.get(rules, method));\n\n        model.permissions[pIndex].rules = rules;\n        form.setState({model});\n    }\n\n    onAdd(model, form, resource) {\n        model.permissions.push({\n            classId: resource.classId,\n            rules: {}\n        });\n        form.setState({model});\n    }\n\n    onRemove(model, form, resource) {\n        const pIndex = _.findIndex(model.permissions, {classId: resource.classId});\n        model.permissions.splice(pIndex, 1);\n        form.setState({model});\n    }\n\n    renderView(Ui) {\n        const newUserPermission = !Webiny.Router.getParams('id');\n\n        return (\n            <Ui.Form\n                api=\"/entities/webiny/user-permissions\"\n                fields=\"id,name,slug,description,permissions\"\n                connectToRouter\n                onSubmitSuccess=\"UserPermissions.List\"\n                onCancel=\"UserPermissions.List\"\n                defaultModel={{permissions: []}}\n                onSuccessMessage={({model}) => {\n                    return <span>{this.i18n('Permission {permission} was saved successfully!', {permission: <strong>{model.name}</strong>})}</span>;\n\n                }}>\n                {({model, form}) => {\n                    return (\n                        <Ui.View.Form>\n                            <Ui.View.Header title={model.id ? this.i18n('ACL - Edit permission') : this.i18n('ACL - Create permission')}/>\n                            <Ui.View.Body>\n                                <Ui.Section title={this.i18n('General')}/>\n                                <Ui.Grid.Row>\n                                    <Ui.Grid.Col all={6}>\n                                        <Ui.Input label={this.i18n('Name')} name=\"name\" validate=\"required\"/>\n                                    </Ui.Grid.Col>\n                                    <Ui.Grid.Col all={6}>\n                                        <Ui.Input label={this.i18n('Slug')} name=\"slug\"/>\n                                    </Ui.Grid.Col>\n                                </Ui.Grid.Row>\n                                <Ui.Grid.Row>\n                                    <Ui.Grid.Col all={12}>\n                                        <Ui.Input label={this.i18n('Description')} name=\"description\" validate=\"required\"/>\n                                        <Ui.Tabs>\n                                            <Ui.Tabs.Tab label={this.i18n('Entities')}>\n                                                {(newUserPermission || model.id) && (\n                                                    <EntityPermissions\n                                                        model={model}\n                                                        onTogglePermission={(classId, method) => this.onToggle(model, form, classId, method)}\n                                                        onAddEntity={resource => this.onAdd(model, form, resource)}\n                                                        onRemoveEntity={resource => this.onRemove(model, form, resource)}/>\n                                                )}\n                                            </Ui.Tabs.Tab>\n                                            <Ui.Tabs.Tab label={this.i18n('Services')}>\n                                                {(newUserPermission || model.id) && (\n                                                    <ServicePermissions\n                                                        model={model}\n                                                        onTogglePermission={(classId, method) => this.onToggle(model, form, classId, method)}\n                                                        onAddService={resource => this.onAdd(model, form, resource)}\n                                                        onRemoveService={resource => this.onRemove(model, form, resource)}/>\n                                                )}\n                                            </Ui.Tabs.Tab>\n                                        </Ui.Tabs>\n                                    </Ui.Grid.Col>\n                                </Ui.Grid.Row>\n                            </Ui.View.Body>\n                            <Ui.View.Footer>\n                                <Ui.Button type=\"default\" onClick={form.cancel} label={this.i18n('Go back')}/>\n                                <Ui.Button type=\"primary\" onClick={form.submit} label={this.i18n('Save permission')} align=\"right\"/>\n                            </Ui.View.Footer>\n                        </Ui.View.Form>\n                    );\n                }}\n            </Ui.Form>\n        );\n    }\n}\n\nUserPermissionsForm.defaultProps = {\n    renderer() {\n        return (\n            <Webiny.Ui.LazyLoad\n                modules={['Form', 'Section', 'View', 'Grid', 'Tabs', 'Input', 'Label', 'Button', 'Switch']}>\n                {Ui => this.renderView(Ui)}\n            </Webiny.Ui.LazyLoad>\n        );\n    }\n};\n\nexport default UserPermissionsForm;\n"]}