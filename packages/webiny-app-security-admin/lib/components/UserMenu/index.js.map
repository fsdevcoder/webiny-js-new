{"version":3,"sources":["../../../src/components/UserMenu/index.js"],"names":["UserMenu","props","state","user","auth","services","get","unwatch","onIdentity","setState","identity","item","logoutMenuItem","logout","isValidElement","cloneElement","createElement","render","call","getUserName","userMenuItems","map","i","renderLogoutMenuItem","Component","modules","loadByTag","then","Object","values","filter","m"],"mappings":"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","file":"index.js","sourcesContent":["import React from \"react\";\nimport _ from \"lodash\";\nimport { app, createComponent } from \"webiny-app\";\n\nclass UserMenu extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            user: {}\n        };\n\n        this.auth = app.services.get(\"authentication\");\n    }\n\n    componentDidMount() {\n        this.unwatch = this.auth.onIdentity(identity => {\n            this.setState({ user: identity });\n        });\n\n        this.setState({ user: this.auth.identity });\n    }\n\n    componentWillUnmount() {\n        this.unwatch();\n    }\n\n    getUserName() {\n        const { user } = this.state;\n        if (!_.get(user, \"firstName\") && !_.get(user, \"lastName\")) {\n            return _.get(user, \"email\");\n        }\n\n        return _.get(user, \"firstName\", \"\") + \" \" + _.get(user, \"lastName\", \"\");\n    }\n\n    renderLogoutMenuItem() {\n        const item = this.props.logoutMenuItem;\n        if (!item) {\n            return null;\n        }\n\n        const logout = {\n            logout: () => {\n                this.auth.logout();\n            }\n        };\n        return React.isValidElement(item)\n            ? React.cloneElement(item, logout)\n            : React.createElement(item, logout);\n    }\n\n    render() {\n        if (this.props.render) {\n            return this.props.render.call(this);\n        }\n\n        if (!this.state.user) {\n            return null;\n        }\n\n        return (\n            <div className=\"dropdown profile-holder\">\n                <a href=\"#\" className=\"profile\" data-toggle=\"dropdown\">\n                    <span className=\"icon-user icon\" />\n                    <span className=\"user\">{this.getUserName()}</span>\n                </a>\n\n                <div className=\"drop dropdown-menu\" role=\"menu\">\n                    <span className=\"top-arr\" />\n                    <ul>\n                        {this.props.userMenuItems.map((item, i) => (\n                            <li key={i}>\n                                {React.isValidElement(item) ? item : React.createElement(item)}\n                            </li>\n                        ))}\n                    </ul>\n                    {this.renderLogoutMenuItem()}\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default createComponent(UserMenu, {\n    modules: [\n        {\n            userMenuItems: () => {\n                return app.modules.loadByTag(\"user-menu-item\").then(modules => {\n                    return Object.values(modules).filter(m => !_.isNil(m));\n                });\n            },\n            logoutMenuItem: \"Admin.UserMenu.Logout\"\n        }\n    ]\n});\n"]}