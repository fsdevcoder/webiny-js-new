{"version":3,"sources":["../../src/router/Router.js"],"names":["debug","Router","routes","config","history","middleware","match","route","params","path","push","name","basename","query","pathname","startsWith","substring","length","i","exact","parse","location","search","output"],"mappings":"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","file":"Router.js","sourcesContent":["import invariant from \"invariant\";\nimport compose from \"webiny-compose\";\nimport debugFactory from \"debug\";\nimport pathToRegExp from \"path-to-regexp\";\nimport _ from \"lodash\";\nimport qs from \"query-string\";\nimport { createBrowserHistory } from \"history\";\nimport Route from \"./Route.cmp\";\nimport matchPath from \"./matchPath\";\nimport generatePath from \"./generatePath\";\nimport sortRoutes from \"./sortRoutes\";\n\nconst debug = debugFactory(\"webiny-app:router\");\n\nclass Router {\n    config: {\n        history: any,\n        basename: string,\n        middleware: Array<Function>\n    };\n    middleware: Function;\n    routes: Array<Route>;\n    match: Object;\n    route: Object;\n\n    constructor() {\n        this.routes = [];\n    }\n\n    configure(config: Object) {\n        this.config = { ...config };\n        this.history = config.history;\n        this.middleware = compose(config.middleware);\n        this.match = null;\n\n        if (!this.history) {\n            this.history = createBrowserHistory();\n        }\n    }\n\n    addRoute(route: Route) {\n        route.params = [];\n        pathToRegExp(route.path, route.params);\n        this.routes.push(route);\n    }\n\n    goToRoute(name: string, params: {}) {\n        const route = name === \"current\" ? this.route : _.find(this.routes, { name });\n        invariant(route, `Route \"${name}\" does not exist!`);\n        const path = generatePath(route.path, params);\n\n        this.history.push(path);\n    }\n\n    createHref(name: string, params?: Object) {\n        const route = _.find(this.routes, { name });\n        return generatePath((this.config.basename || \"\") + route.path, params);\n    }\n\n    getParams(name = null) {\n        return name ? this.match.params[name] : this.match.params;\n    }\n\n    getQuery(name = null) {\n        return name ? this.match.query[name] : this.match.query;\n    }\n\n    getRoute(name) {\n        return _.find(this.routes, { name });\n    }\n\n    async matchRoute(pathname: string) {\n        debug(\"Matching location %o\", pathname);\n        let route = null;\n        if (pathname.startsWith(this.config.basename)) {\n            pathname = pathname.substring(this.config.basename.length);\n        }\n\n        if (pathname === \"\") {\n            pathname = \"/\";\n        }\n\n        sortRoutes(this.routes);\n\n        for (let i = 0; i < this.routes.length; i++) {\n            route = _.cloneDeep(this.routes[i]);\n            const match = matchPath(pathname, {\n                path: route.path,\n                exact: route.exact\n            });\n\n            if (!match) {\n                continue;\n            }\n\n            match.query = qs.parse(this.history.location.search);\n\n            this.route = route;\n            this.match = match;\n\n            const params = { route, output: null, match };\n            await this.middleware(params);\n\n            return params.output;\n        }\n\n        return route;\n    }\n}\n\nexport default Router;\n"]}