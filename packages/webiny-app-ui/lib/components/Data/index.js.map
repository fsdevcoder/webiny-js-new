{"version":3,"sources":["../../../src/components/Data/index.js"],"names":["Data","props","autoRefreshInterval","mounted","request","cancelRequest","state","data","initiallyLoaded","setData","bind","load","catchError","getCancelToken","setState","loading","api","cancelToken","then","response","onInitialLoad","catch","autoRefresh","setInterval","clearInterval","CancelToken","cancel","err","isCancel","services","get","danger","message","prepareLoadedData","filters","params","onLoad","children","Error","waitForData","Loader","loader","call","$this","Component","defaultProps","modules"],"mappings":"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","file":"index.js","sourcesContent":["import React from \"react\";\nimport _ from \"lodash\";\nimport { app, createComponent, ApiComponent } from \"webiny-app\";\nimport axios from \"axios\";\n\nclass Data extends React.Component {\n    constructor(props) {\n        super(props);\n        this.autoRefreshInterval = null; // Ony when 'autoRefresh' prop is used\n        this.mounted = false;\n        this.request = null;\n        this.cancelRequest = null;\n\n        this.state = {\n            data: null,\n            initiallyLoaded: false\n        };\n\n        this.setData = this.setData.bind(this);\n        this.load = this.load.bind(this);\n        this.catchError = this.catchError.bind(this);\n        this.getCancelToken = this.getCancelToken.bind(this);\n    }\n\n    componentWillMount() {\n        this.setState({ loading: true });\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.request = this.props.api\n            .request({\n                cancelToken: this.getCancelToken()\n            })\n            .then(response => {\n                if (!this.mounted) {\n                    return null;\n                }\n                this.setData(response);\n                this.setState({ initiallyLoaded: true });\n                this.props.onInitialLoad(response);\n                return response.data.data;\n            })\n            .catch(this.catchError);\n\n        if (_.isNumber(this.props.autoRefresh)) {\n            this.autoRefreshInterval = setInterval(() => {\n                this.request = this.props.api\n                    .request({\n                        cancelToken: this.getCancelToken()\n                    })\n                    .then(response => {\n                        this.setData(response);\n                        return response.data.data;\n                    })\n                    .catch(this.catchError);\n            }, this.props.autoRefresh * 1000);\n        }\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n\n        if (this.cancelRequest) {\n            this.cancelRequest();\n        }\n\n        if (this.autoRefreshInterval) {\n            clearInterval(this.autoRefreshInterval);\n        }\n    }\n\n    getCancelToken() {\n        return new axios.CancelToken(cancel => {\n            this.cancelRequest = cancel;\n        });\n    }\n\n    catchError(err) {\n        if (axios.isCancel(err)) {\n            return this.mounted ? this.setState({ loading: false }) : null;\n        }\n        app.services.get(\"growler\").danger(err.message);\n    }\n\n    setData(response) {\n        this.request = null;\n\n        this.setState({\n            data: this.props.prepareLoadedData({ data: response.data.data }),\n            loading: false\n        });\n    }\n\n    load(filters = {}) {\n        this.setState({ loading: true });\n        this.request = this.props.api.request({ params: filters }).then(response => {\n            if (!this.mounted) {\n                return;\n            }\n            this.setData(response);\n            this.props.onLoad(response);\n        });\n        return this.request;\n    }\n\n    render() {\n        if (!_.isFunction(this.props.children)) {\n            throw new Error(\n                \"Warning: Data component only accepts a function as its child element!\"\n            );\n        }\n\n        if (this.props.waitForData && this.state.data === null) {\n            return null;\n        }\n\n        const { Loader } = this.props;\n        const loader = this.state.loading ? <Loader /> : null;\n\n        return (\n            <webiny-data>\n                {this.props.children.call(this, {\n                    data: _.cloneDeep(this.state.data),\n                    load: this.load,\n                    loader,\n                    $this: this\n                })}\n            </webiny-data>\n        );\n    }\n}\n\nData.defaultProps = {\n    waitForData: true,\n    autoRefresh: null,\n    onLoad: _.noop,\n    onInitialLoad: _.noop,\n    prepareLoadedData: ({ data }) => data\n};\n\nexport default createComponent([Data, ApiComponent], { modules: [\"Loader\"] });\n"]}