{"version":3,"sources":["../../../src/components/Form/LinkState.js"],"names":["LinkState","component","key","callback","defaultValue","value","__getValue","onChange","__createStateKeySetter","state","_this","stateKeySetter","Promise","oldValue","promise","resolve","then","newValue","undefined","partialState","setState"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEMA,S;AAEF,uBAAYC,SAAZ,EAAuBC,GAAvB,EAA4BC,QAA5B,EAA2D;AAAA,YAArBC,YAAqB,uEAAN,IAAM;AAAA;;AACvD,aAAKH,SAAL,GAAiBA,SAAjB;AACA,aAAKC,GAAL,GAAWA,GAAX;AACA,aAAKC,QAAL,GAAgBA,QAAhB;AACA,aAAKC,YAAL,GAAoBA,YAApB;AACH;;;;iCAEQ;AACL,mBAAO;AACHC,uBAAO,KAAKC,UAAL,CAAgB,KAAKJ,GAArB,CADJ;AAEHK,0BAAU,KAAKC,sBAAL;AAFP,aAAP;AAIH;;;mCAEUN,G,EAAK;AACZ,mBAAO,mBAAM,KAAKD,SAAL,CAAeQ,KAArB,EAA4BP,GAA5B,EAAiC,KAAKE,YAAtC,CAAP;AACH;;;iDAEwB;AACrB,gBAAMH,YAAY,KAAKA,SAAvB;AACA,gBAAMC,MAAM,KAAKA,GAAjB;;AAEA,gBAAMQ,QAAQ,IAAd;AACA,mBAAO,SAASC,cAAT,CAAwBN,KAAxB,EAAkD;AAAA,oBAAnBF,QAAmB;;AACrD,uBAAO,IAAIS,OAAJ,CAAY,mBAAW;AAC1B,wBAAI,OAAOP,KAAP,KAAiB,WAArB,EAAkC;AAC9BA,gCAAQ,KAAR;AACH;AACD,wBAAMQ,WAAWH,MAAMJ,UAAN,CAAiBJ,GAAjB,CAAjB;;AAEA,wBAAIY,UAAUF,QAAQG,OAAR,CAAgBV,KAAhB,CAAd;AACA,wBAAIK,MAAMP,QAAV,EAAoB;AAChBW,kCAAUF,QAAQG,OAAR,CAAgBL,MAAMP,QAAN,CAAeE,KAAf,EAAsBQ,QAAtB,CAAhB,EAAiDG,IAAjD,CAAsD,oBAAY;AACxE,mCAAOC,aAAaC,SAAb,GAAyBb,KAAzB,GAAiCY,QAAxC;AACH,yBAFS,CAAV;AAGH;;AAED,2BAAOH,QAAQE,IAAR,CAAa,iBAAS;AACzB,4BAAIG,eAAelB,UAAUQ,KAA7B;AACA,2CAAMU,YAAN,EAAoBjB,GAApB,EAAyBG,KAAzB;AACAJ,kCAAUmB,QAAV,CAAmBD,YAAnB,EAAiC,YAAM;AACnC,gCAAI,0BAAahB,QAAb,CAAJ,EAA4B;AACxBA,yCAASE,KAAT,EAAgBQ,QAAhB;AACH;AACDM,2CAAe,IAAf;AACAJ,oCAAQV,KAAR;AACH,yBAND;AAOH,qBAVM,CAAP;AAWH,iBAxBM,CAAP;AAyBH,aA1BD;AA2BH;;;;;kBAGUL,S","file":"LinkState.js","sourcesContent":["import _ from 'lodash';\n\nclass LinkState {\n\n    constructor(component, key, callback, defaultValue = null) {\n        this.component = component;\n        this.key = key;\n        this.callback = callback;\n        this.defaultValue = defaultValue;\n    }\n\n    create() {\n        return {\n            value: this.__getValue(this.key),\n            onChange: this.__createStateKeySetter()\n        };\n    }\n\n    __getValue(key) {\n        return _.get(this.component.state, key, this.defaultValue);\n    }\n\n    __createStateKeySetter() {\n        const component = this.component;\n        const key = this.key;\n\n        const _this = this;\n        return function stateKeySetter(value, callback = _.noop) {\n            return new Promise(resolve => {\n                if (typeof value === 'undefined') {\n                    value = false;\n                }\n                const oldValue = _this.__getValue(key);\n\n                let promise = Promise.resolve(value);\n                if (_this.callback) {\n                    promise = Promise.resolve(_this.callback(value, oldValue)).then(newValue => {\n                        return newValue === undefined ? value : newValue;\n                    });\n                }\n\n                return promise.then(value => {\n                    let partialState = component.state;\n                    _.set(partialState, key, value);\n                    component.setState(partialState, () => {\n                        if (_.isFunction(callback)) {\n                            callback(value, oldValue);\n                        }\n                        partialState = null;\n                        resolve(value);\n                    });\n                });\n            });\n        };\n    }\n}\n\nexport default LinkState;\n"]}