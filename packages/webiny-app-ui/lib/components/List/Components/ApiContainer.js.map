{"version":3,"sources":["../../../../src/components/List/Components/ApiContainer.jsx"],"names":["t","namespace","ApiContainer","props","state","initiallyLoaded","routerParams","mounted","map","m","bind","autoLoad","loadData","then","setState","onInitialLoad","list","data","meta","autoRefresh","setInterval","clearInterval","request","shouldLoad","propKeys","onLoad","showLoading","query","_sort","Object","keys","sorters","length","initialSorters","_perPage","perPage","_page","page","_searchQuery","searchQuery","_searchFields","searchFields","_searchOperator","searchOperator","filters","api","params","response","code","prepareLoadedData","$this","services","get","danger","message","loading","selectedRows","id","attributes","patch","defaults","url","delete","content","getContent","children","layout","Children","prepareElement","layoutProps","prepareList","actions","update","recordUpdate","recordDelete","reload","container","call","Component","defaultProps","table","pagination","multiActions","loader","Grid","styles","footer","multiAction","paginationWrapper","modules"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AAEA;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,IAAI,gBAAKC,SAAL,CAAe,6BAAf,CAAV;;IACMC,Y;;;AAEF,0BAAYC,KAAZ,EAAmB;AAAA;;AAAA,8IACTA,KADS;;AAGf,cAAKC,KAAL,GAAa;AACTC,6BAAiB,KADR;AAETC,0BAAc;AAFL,SAAb;;AAKA,cAAKC,OAAL,GAAe,KAAf;;AAEA,SAAC,UAAD,EAAa,cAAb,EAA6B,cAA7B,EAA6CC,GAA7C,CAAiD;AAAA,mBAAK,MAAKC,CAAL,IAAU,MAAKA,CAAL,EAAQC,IAAR,OAAf;AAAA,SAAjD;AAVe;AAWlB;;;;6CAEoB;AAAA;;AACjB,iBAAKH,OAAL,GAAe,IAAf;;AAEA,gBAAI,KAAKJ,KAAL,CAAWQ,QAAf,EAAyB;AACrB,qBAAKC,QAAL,GAAgBC,IAAhB,CAAqB,gBAAQ;AACzB,wBAAI,CAAC,OAAKN,OAAV,EAAmB;AACf;AACH;AACD,2BAAKO,QAAL,CAAc,EAAET,iBAAiB,IAAnB,EAAd;AACA,2BAAKF,KAAL,CAAWY,aAAX,CAAyB,EAAEC,MAAM,mBAAMC,IAAN,EAAY,MAAZ,CAAR,EAA6BC,MAAM,mBAAMD,IAAN,EAAY,MAAZ,CAAnC,EAAzB;AACH,iBAND;AAOH;AACJ;;;4CAEmB;AAAA;;AAChB,gBAAI,KAAKd,KAAL,CAAWgB,WAAX,IAA0B,wBAAW,KAAKhB,KAAL,CAAWgB,WAAtB,CAA9B,EAAkE;AAC9D,qBAAKA,WAAL,GAAmBC,YAAY;AAAA,2BAAM,OAAKR,QAAL,CAAc,IAAd,EAAoB,KAApB,CAAN;AAAA,iBAAZ,EAA8C,OAAO,KAAKT,KAAL,CAAWgB,WAAhE,CAAnB;AACH;AACJ;;;+CAEsB;AACnB,iBAAKZ,OAAL,GAAe,KAAf;AACAc,0BAAc,KAAKF,WAAnB;AACA,gBAAI,KAAKG,OAAT,EAAkB;AACd;AACH;AACJ;;;kDAEyBnB,K,EAAO;AAAA;;AAC7B,gBAAIoB,aAAa,KAAjB;;AAEA,gBAAMC,WAAW,CAAC,SAAD,EAAY,SAAZ,EAAuB,SAAvB,EAAkC,MAAlC,EAA0C,aAA1C,EAAyD,cAAzD,EAAyE,gBAAzE,CAAjB;AACA,gBAAI,CAAC,uBAAU,oBAAOrB,KAAP,EAAcqB,QAAd,CAAV,EAAmC,oBAAO,KAAKrB,KAAZ,EAAmBqB,QAAnB,CAAnC,CAAL,EAAuE;AACnED,6BAAa,IAAb;AACH;;AAED,gBAAI,KAAKpB,KAAL,CAAWQ,QAAX,IAAuBY,UAA3B,EAAuC;AACnC,qBAAKX,QAAL,CAAcT,KAAd,EAAqBU,IAArB,CAA0B,gBAAQ;AAC9B,2BAAKV,KAAL,CAAWsB,MAAX,CAAkB,EAAET,MAAM,mBAAMC,IAAN,EAAY,MAAZ,CAAR,EAA6BC,MAAM,mBAAMD,IAAN,EAAY,MAAZ,CAAnC,EAAlB;AACH,iBAFD;AAGH;AACJ;;;mCAE0C;AAAA;;AAAA,gBAAlCd,KAAkC,uEAA1B,IAA0B;AAAA,gBAApBuB,WAAoB,uEAAN,IAAM;;AACvC,gBAAI,CAACvB,KAAL,EAAY;AACRA,wBAAQ,KAAKA,KAAb;AACH;;AAED,gBAAI,KAAKmB,OAAT,EAAkB;AACd;AACH;;AAED,gBAAMK,QAAQ,sBAAS,EAAT,EAAaxB,MAAMwB,KAAnB,EAA0B;AACpCC,uBAAOC,OAAOC,IAAP,CAAY3B,MAAM4B,OAAlB,EAA2BC,MAA3B,GAAoC,+BAAgB7B,MAAM4B,OAAtB,CAApC,GAAqE5B,MAAM8B,cAD9C;AAEpCC,0BAAU/B,MAAMgC,OAFoB;AAGpCC,uBAAOjC,MAAMkC,IAHuB;AAIpCC,8BAAcnC,MAAMoC,WAJgB;AAKpCC,+BAAerC,MAAMsC,YALe;AAMpCC,iCAAiBvC,MAAMwC;AANa,aAA1B,EAOXxC,MAAMyC,OAPK,CAAd;;AASA,gBAAIlB,WAAJ,EAAiB;AACb,qBAAKvB,KAAL,CAAWuB,WAAX;AACH;;AAED,iBAAKJ,OAAL,GAAenB,MAAM0C,GAAN,CAAUvB,OAAV,CAAkB,EAAEwB,QAAQnB,KAAV,EAAlB,EAAqCd,IAArC,CAA0C,oBAAY;AAAA,oBACzDI,IADyD,GAChD8B,SAAS9B,IADuC,CACzDA,IADyD;;AAEjE,oBAAI,CAAC8B,SAAS9B,IAAT,CAAc+B,IAAf,IAAuB7C,MAAM8C,iBAAjC,EAAoD;AAChDhC,yBAAKD,IAAL,GAAYb,MAAM8C,iBAAN,CAAwB,EAAEjC,MAAMC,KAAKD,IAAb,EAAmBE,MAAMD,KAAKC,IAA9B,EAAoCgC,aAApC,EAAxB,CAAZ;AACH;;AAED,oBAAIH,SAAS9B,IAAT,CAAc+B,IAAlB,EAAwB;AACpB,mCAAIG,QAAJ,CAAaC,GAAb,CAAiB,SAAjB,EAA4BC,MAA5B,CAAmCN,SAAS9B,IAAT,CAAcqC,OAAjD,EAA0DtD,CAA1D,mBAA6F,IAA7F;AACH;;AAED,oBAAI,OAAKO,OAAT,EAAkB;AACdJ,0BAAMW,QAAN,iBAAiByC,SAAS,KAA1B,IAAoCtC,IAApC,IAA0CuC,cAAc,EAAxD;AACH;;AAED,uBAAOvC,IAAP;AACH,aAfc,CAAf;;AAiBA,mBAAO,KAAKK,OAAZ;AACH;;;qCAEYmC,E,EAAIC,U,EAAY;AAAA;;AACzB,mBAAO,KAAKvD,KAAL,CAAW0C,GAAX,CAAec,KAAf,CAAqB,KAAKxD,KAAL,CAAW0C,GAAX,CAAee,QAAf,CAAwBC,GAAxB,GAA8B,GAA9B,GAAoCJ,EAAzD,EAA6DC,UAA7D,EAAyE7C,IAAzE,CAA8E,oBAAY;AAC7F,oBAAI,CAACkC,SAAS9B,IAAT,CAAc+B,IAAnB,EAAyB;AACrB,2BAAKpC,QAAL;AACH,iBAFD,MAEO;AACH,mCAAIuC,QAAJ,CAAaC,GAAb,CAAiB,SAAjB,EAA4BC,MAA5B,CAAmCN,SAAS9B,IAAT,CAAcqC,OAAjD,EAA0DtD,CAA1D,mBAA6F,IAA7F;AACH;AACD,uBAAO+C,QAAP;AACH,aAPM,CAAP;AAQH;;;qCAEYU,E,EAAwB;AAAA;;AAAA,gBAApBtC,WAAoB,uEAAN,IAAM;;AACjC,mBAAO,KAAKhB,KAAL,CAAW0C,GAAX,CAAeiB,MAAf,CAAsB,KAAK3D,KAAL,CAAW0C,GAAX,CAAee,QAAf,CAAwBC,GAAxB,GAA8B,GAA9B,GAAoCJ,EAA1D,EAA8D5C,IAA9D,CAAmE,oBAAY;AAClF,oBAAI,CAACkC,SAAS9B,IAAT,CAAc+B,IAAf,IAAuB7B,WAA3B,EAAwC;AACpC,2BAAKP,QAAL;AACH,iBAFD,MAEO;AACH,mCAAIuC,QAAJ,CAAaC,GAAb,CAAiB,SAAjB,EAA4BC,MAA5B,CAAmCN,SAAS9B,IAAT,CAAcqC,OAAjD,EAA0DtD,CAA1D,mBAA6F,IAA7F;AACH;AACD,uBAAO+C,QAAP;AACH,aAPM,CAAP;AAQH;;;iCAEQ;AACL,gBAAMgB,UAAU,KAAK5D,KAAL,CAAW6D,UAAX,CAAsB,KAAK7D,KAAL,CAAW8D,QAAjC,CAAhB;;AAEA,gBAAI,CAACF,OAAL,EAAc;AACV,uBAAO,IAAP;AACH;;AAED,gBAAI,CAAC,KAAK5D,KAAL,CAAW+D,MAAhB,EAAwB;AACpB,uBAAO;AAAA;AAAA;AAAc,oCAAMC,QAAN,CAAe3D,GAAf,CAAmBuD,OAAnB,EAA4B,KAAKK,cAAjC,EAAiD,IAAjD;AAAd,iBAAP;AACH;;AAED,gBAAMC,gCACC,KAAKlE,KAAL,CAAWmE,WAAX,CAAuBP,OAAvB,EAAgC;AAC/BQ,yBAAS;AACLC,4BAAQ,KAAKC,YADR;AAELX,4BAAQ,KAAKY,YAFR;AAGLC,4BAAQ,KAAK/D,QAHR;AAILiC,yBAAK,KAAK1C,KAAL,CAAW0C;AAJX;AADsB,aAAhC,CADD;AASF7B,sBAAM,KAAKZ,KAAL,CAAWY,IATf;AAUFE,sBAAM,KAAKd,KAAL,CAAWc,IAVf;AAWF0D,2BAAW;AAXT,cAAN;;AAcA,mBAAO,KAAKzE,KAAL,CAAW+D,MAAX,CAAkBW,IAAlB,CAAuB,IAAvB,EAA6BR,WAA7B,CAAP;AACH;;;EApJsB,gBAAMS,S;;AAuJjC5E,aAAa6E,YAAb,GAA4B;AACxBhE,iCADwB;AAExBU,0BAFwB;AAGxBd,cAAU,IAHc;AAIxBQ,iBAAa,IAJW;AAKxB8B,uBAAmB,IALK;AAMxBiB,UANwB,wBAMqC;AAAA,YAApDtB,OAAoD,QAApDA,OAAoD;AAAA,YAA3CoC,KAA2C,QAA3CA,KAA2C;AAAA,YAApCC,UAAoC,QAApCA,UAAoC;AAAA,YAAxBC,YAAwB,QAAxBA,YAAwB;AAAA,YAAVC,MAAU,QAAVA,MAAU;AAAA,qBAChC,KAAKhF,KAD2B;AAAA,YACjDiF,IADiD,UACjDA,IADiD;AAAA,YAC3CC,MAD2C,UAC3CA,MAD2C;;AAEzD,eACI;AAAA;AAAA;AACKF,kBADL;AAEKvC,mBAFL;AAGKoC,iBAHL;AAII;AAAC,oBAAD,CAAM,GAAN;AAAA,kBAAU,WAAWK,OAAOC,MAA5B;AACI;AAAC,wBAAD,CAAM,GAAN;AAAA,sBAAU,IAAI,CAAd,EAAiB,WAAWD,OAAOE,WAAnC;AACKL;AADL,iBADJ;AAII;AAAC,wBAAD,CAAM,GAAN;AAAA,sBAAU,IAAI,CAAd,EAAiB,WAAWG,OAAOG,iBAAnC;AACKP;AADL;AAJJ;AAJJ,SADJ;AAeH;AAvBuB,CAA5B;;kBA0Be,gCAAgB,CAAC/E,YAAD,mDAAhB,EAA6D,EAAEuF,SAAS,CAAC,MAAD,CAAX,EAAqBJ,wBAArB,EAA7D,C","file":"ApiContainer.js","sourcesContent":["import React from 'react';\nimport _ from 'lodash';\nimport { app, createComponent, ApiComponent, i18n } from 'webiny-app';\nimport BaseContainer from './BaseContainer';\nimport sortersToString from './sortersToString';\nimport styles from './../styles.css';\n\nconst t = i18n.namespace(\"Webiny.Ui.List.ApiContainer\");\nclass ApiContainer extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            initiallyLoaded: false,\n            routerParams: null\n        };\n\n        this.mounted = false;\n\n        ['loadData', 'recordUpdate', 'recordDelete'].map(m => this[m] = this[m].bind(this));\n    }\n\n    componentWillMount() {\n        this.mounted = true;\n\n        if (this.props.autoLoad) {\n            this.loadData().then(data => {\n                if (!this.mounted) {\n                    return;\n                }\n                this.setState({ initiallyLoaded: true });\n                this.props.onInitialLoad({ list: _.get(data, 'list'), meta: _.get(data, 'meta') });\n            });\n        }\n    }\n\n    componentDidMount() {\n        if (this.props.autoRefresh && _.isNumber(this.props.autoRefresh)) {\n            this.autoRefresh = setInterval(() => this.loadData(null, false), 1000 * this.props.autoRefresh);\n        }\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n        clearInterval(this.autoRefresh);\n        if (this.request) {\n            // TODO: this.cancelRequest();\n        }\n    }\n\n    componentWillReceiveProps(props) {\n        let shouldLoad = false;\n\n        const propKeys = ['sorters', 'filters', 'perPage', 'page', 'searchQuery', 'searchFields', 'searchOperator'];\n        if (!_.isEqual(_.pick(props, propKeys), _.pick(this.props, propKeys))) {\n            shouldLoad = true;\n        }\n\n        if (this.props.autoLoad && shouldLoad) {\n            this.loadData(props).then(data => {\n                this.props.onLoad({ list: _.get(data, 'list'), meta: _.get(data, 'meta') });\n            });\n        }\n    }\n\n    loadData(props = null, showLoading = true) {\n        if (!props) {\n            props = this.props;\n        }\n\n        if (this.request) {\n            // TODO: this.cancelRequest();\n        }\n\n        const query = _.assign({}, props.query, {\n            _sort: Object.keys(props.sorters).length ? sortersToString(props.sorters) : props.initialSorters,\n            _perPage: props.perPage,\n            _page: props.page,\n            _searchQuery: props.searchQuery,\n            _searchFields: props.searchFields,\n            _searchOperator: props.searchOperator\n        }, props.filters);\n\n        if (showLoading) {\n            this.props.showLoading();\n        }\n\n        this.request = props.api.request({ params: query }).then(response => {\n            const { data } = response.data;\n            if (!response.data.code && props.prepareLoadedData) {\n                data.list = props.prepareLoadedData({ list: data.list, meta: data.meta, $this: this });\n            }\n\n            if (response.data.code) {\n                app.services.get('growler').danger(response.data.message, t`That didn\\'t go as expected...`, true);\n            }\n\n            if (this.mounted) {\n                props.setState({ loading: false, ...data, selectedRows: [] });\n            }\n\n            return data;\n        });\n\n        return this.request;\n    }\n\n    recordUpdate(id, attributes) {\n        return this.props.api.patch(this.props.api.defaults.url + '/' + id, attributes).then(response => {\n            if (!response.data.code) {\n                this.loadData();\n            } else {\n                app.services.get('growler').danger(response.data.message, t`That didn\\'t go as expected...`, true);\n            }\n            return response;\n        });\n    }\n\n    recordDelete(id, autoRefresh = true) {\n        return this.props.api.delete(this.props.api.defaults.url + '/' + id).then(response => {\n            if (!response.data.code && autoRefresh) {\n                this.loadData();\n            } else {\n                app.services.get('growler').danger(response.data.message, t`That didn\\'t go as expected...`, true);\n            }\n            return response;\n        });\n    }\n\n    render() {\n        const content = this.props.getContent(this.props.children);\n\n        if (!content) {\n            return null;\n        }\n\n        if (!this.props.layout) {\n            return <webiny-list>{React.Children.map(content, this.prepareElement, this)}</webiny-list>;\n        }\n\n        const layoutProps = {\n            ...this.props.prepareList(content, {\n                actions: {\n                    update: this.recordUpdate,\n                    delete: this.recordDelete,\n                    reload: this.loadData,\n                    api: this.props.api\n                }\n            }),\n            list: this.state.list,\n            meta: this.state.meta,\n            container: this\n        };\n\n        return this.props.layout.call(this, layoutProps)\n    }\n}\n\nApiContainer.defaultProps = {\n    onInitialLoad: _.noop,\n    onLoad: _.noop,\n    autoLoad: true,\n    autoRefresh: null,\n    prepareLoadedData: null,\n    layout({ filters, table, pagination, multiActions, loader }) {\n        const { Grid, styles } = this.props;\n        return (\n            <webiny-list-layout>\n                {loader}\n                {filters}\n                {table}\n                <Grid.Row className={styles.footer}>\n                    <Grid.Col sm={4} className={styles.multiAction}>\n                        {multiActions}\n                    </Grid.Col>\n                    <Grid.Col sm={8} className={styles.paginationWrapper}>\n                        {pagination}\n                    </Grid.Col>\n                </Grid.Row>\n            </webiny-list-layout>\n        );\n    }\n};\n\nexport default createComponent([ApiContainer, BaseContainer, ApiComponent], { modules: ['Grid'], styles });"]}