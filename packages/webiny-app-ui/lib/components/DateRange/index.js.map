{"version":3,"sources":["../../../src/components/DateRange/index.js"],"names":["DateRange","props","input","state","date","start","end","rangeType","moment","options","autoApply","alwaysShowCalendars","opens","locale","format","ranges","Today","Yesterday","subtract","startOf","endOf","availableOptions","bindMethods","prevProps","prevState","isValid","setState","validationMessage","unregisterListeners","getInput","value","getPlaceholder","dates","split","rangeDelimiter","element","data","setStartDate","setEndDate","from","to","startDate","endDate","left","offset","windowWidth","window","innerWidth","range","inputFormat","getValue","parts","setInitialRange","daterangepicker","on","ev","picker","onChange","fromYmd","modelFormat","toYmd","validate","e","console","log","off","Ui","FormComponent","defaultProps","extendProps","renderer","omitProps","Input","Icon","addonRight","renderPreview","onComponentDidMount","setup","ref","createComponent","modules"],"mappings":"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","file":"index.js","sourcesContent":["import React from \"react\";\nimport _ from \"lodash\";\nimport $ from \"jquery\";\nimport { Webiny } from \"webiny-app\";\nimport \"bootstrap-daterangepicker\";\nimport \"./styles.scss?extract\";\n\n/**\n * TODO: complete I18N support needed.\n */\nclass DateRange extends Webiny.Ui.FormComponent {\n    constructor(props) {\n        super(props);\n\n        this.input = null;\n\n        _.assign(this.state, {\n            date: {\n                start: null,\n                end: null\n            },\n            rangeType: _.get(this.props, \"rangeType\", \"\")\n        });\n\n        const { moment } = props;\n\n        this.options = {\n            autoApply: true,\n            alwaysShowCalendars: true,\n            opens: \"left\",\n            locale: {\n                format: \"DD/MMM/YY\"\n            },\n            ranges: {\n                Today: [moment(), moment()],\n                Yesterday: [moment().subtract(1, \"days\"), moment().subtract(1, \"days\")],\n                \"Last 7 Days\": [moment().subtract(6, \"days\"), moment()],\n                \"Last 30 Days\": [moment().subtract(29, \"days\"), moment()],\n                \"This Month\": [moment().startOf(\"month\"), moment().endOf(\"month\")],\n                \"Last Month\": [\n                    moment()\n                        .subtract(1, \"month\")\n                        .startOf(\"month\"),\n                    moment()\n                        .subtract(1, \"month\")\n                        .endOf(\"month\")\n                ]\n            }\n        };\n\n        this.availableOptions = [\n            \"startDate\",\n            \"endDate\",\n            \"minDate\",\n            \"maxDate\",\n            \"dateLimit\",\n            \"showDropdowns\",\n            \"showWeekNumbers\",\n            \"timePicker\",\n            \"timePickerIncrement\",\n            \"timePicker24hour\",\n            \"timePickerSeconds\",\n            \"ranges\",\n            \"opens\",\n            \"drops\",\n            \"buttonClasses\",\n            \"applyClasses\",\n            \"cancelClasses\",\n            \"locale\",\n            \"singleDatePicker\",\n            \"autoApply\",\n            \"linkedCalendars\",\n            \"parentEl\",\n            \"isInvalidDate\",\n            \"autoUpdateInput\",\n            \"alwaysShowCalendars\"\n        ];\n\n        this.bindMethods(\"setup,onChange,setInitialRange\");\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        super.componentDidUpdate();\n        if (prevState.isValid !== this.state.isValid) {\n            this.input.setState({\n                isValid: this.state.isValid,\n                validationMessage: this.state.validationMessage\n            });\n        }\n    }\n\n    componentWillUnmount(props) {\n        super.componentWillUnmount(props);\n        this.unregisterListeners();\n    }\n\n    componentWillReceiveProps(props) {\n        if (!this.getInput()) {\n            return;\n        }\n\n        if (!props.value) {\n            this.getInput().value = this.getPlaceholder() || \"\";\n        } else {\n            const dates = props.value.split(this.props.rangeDelimiter);\n            this.element.data(\"daterangepicker\").setStartDate(dates[0]);\n            this.element.data(\"daterangepicker\").setEndDate(dates[1]);\n        }\n    }\n\n    setInitialRange(start, end) {\n        const { moment } = this.props;\n        const from = moment(start, this.options.locale.format, true);\n        const to = moment(end, this.options.locale.format, true);\n        if (from.isValid() && to.isValid()) {\n            this.options.startDate = start;\n            this.options.endDate = end;\n        }\n    }\n\n    getInput() {\n        return this.input;\n    }\n\n    setup() {\n        this.element = $(this.getInput());\n\n        // detect to which side we need to open the range selector in case opens is set to auto\n        let opens = \"left\";\n        if (this.props.opens === \"auto\") {\n            let left = this.element.offset().left;\n            let windowWidth = window.innerWidth;\n\n            let offset = left / windowWidth * 100;\n\n            // if within first 30% of the screen, open to left\n            if (offset <= 30) {\n                opens = \"right\";\n            } else if (offset > 30 && offset <= 60) {\n                opens = \"center\";\n            } else {\n                opens = \"left\";\n            }\n        }\n\n        const range = _.get(this.options.ranges, _.get(this.props, \"rangeType\"));\n        _.assign(this.options, this.props.options || {}, _.pick(this.props, this.availableOptions));\n        this.options.locale.format = this.props.inputFormat;\n        this.options.opens = opens;\n\n        const value = this.getValue();\n        if (value) {\n            const parts = value.split(this.props.rangeDelimiter);\n            this.setInitialRange(parts[0], parts[1]);\n        } else if (range) {\n            this.setInitialRange(range[0], range[1]);\n        }\n\n        this.element.daterangepicker(this.options);\n        this.element.on(\"apply.daterangepicker\", (ev, picker) => {\n            this.onChange(picker);\n        });\n\n        if (!value) {\n            this.element[0].value = this.getPlaceholder() || \"\";\n        }\n\n        return this;\n    }\n\n    onChange(picker = {}) {\n        try {\n            if (!this.getInput()) {\n                return this;\n            }\n\n            const { moment } = this.props;\n            const dates = this.getInput().value.split(\" - \");\n            const from = moment(dates[0], this.props.inputFormat, true);\n            const to = moment(dates[1], this.props.inputFormat, true);\n\n            if (from.isValid() && to.isValid()) {\n                const fromYmd = from.format(this.props.modelFormat);\n                const toYmd = to.format(this.props.modelFormat);\n                const state = {\n                    date: {\n                        range: fromYmd + this.props.rangeDelimiter + toYmd,\n                        from: fromYmd,\n                        to: toYmd\n                    },\n                    rangeType: _.get(picker, \"chosenLabel\", this.state.rangeType)\n                };\n                this.setState(state, () => {\n                    this.props.onChange(this.state.date.range, this.validate);\n                });\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    unregisterListeners() {\n        this.element.off(\"apply.daterangepicker\");\n        return this;\n    }\n\n    renderPreview() {\n        if (!this.state.date.range) {\n            return null;\n        }\n\n        const { moment } = this.props;\n        const dates = this.state.date.range.split(this.props.rangeDelimiter);\n        const from = moment(dates[0], this.props.modelFormat, true);\n        const to = moment(dates[1], this.props.modelFormat, true);\n\n        return from.format(this.props.inputFormat + \" - \" + to.format(this.props.inputFormat));\n    }\n}\n\nDateRange.defaultProps = Webiny.Ui.FormComponent.extendProps({\n    inputFormat: \"YYYY-MM-DD\",\n    modelFormat: \"YYYY-MM-DD\",\n    rangeDelimiter: \":\",\n    rangeType: \"Last 30 Days\", // initial date range\n    opens: \"auto\",\n    renderer() {\n        const omitProps = [\n            \"attachToForm\",\n            \"attachValidators\",\n            \"detachFromForm\",\n            \"validateInput\",\n            \"form\",\n            \"renderer\",\n            \"name\",\n            \"onChange\"\n        ];\n        const props = _.omit(this.props, omitProps);\n        const { Input, Icon } = props;\n        props.addonRight = <Icon icon=\"icon-calendar\" />;\n        props.value = this.renderPreview();\n        props.onComponentDidMount = input => {\n            this.input = input;\n            this.setup();\n        };\n\n        return <Input onRef={ref => (this.input = ref)} {...props} />;\n    }\n});\n\nexport default Webiny.createComponent(DateRange, {\n    modules: [\"Icon\", \"Input\", { moment: \"Webiny/Vendors/Moment\" }]\n});\n"]}