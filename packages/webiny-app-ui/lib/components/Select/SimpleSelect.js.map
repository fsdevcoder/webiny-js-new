{"version":3,"sources":["../../../src/components/Select/SimpleSelect.js"],"names":["SimpleSelect","props","select2","options","map","m","bind","instantiate","value","previousData","getCurrentData","possibleValues","obj","id","toString","getValue","inPossibleValues","indexOf","empty","getSelect2InputElement","getConfig","setTimeout","val","trigger","dom","find","prop","disabled","length","triggerChange","autoSelectFirstOption","firstValue","on","e","target","dropdownClassName","data","$dropdown","addClass","undefined","useDataAsValue","option","selectedOption","console","warn","prevValue","onChange","text","startsWith","item","type","renderToStaticMarkup","getOptionText","config","minimumResultsForSearch","minimumInputLength","placeholder","allowClear","templateResult","itemRenderer","templateSelection","matcher","params","term","trim","dropdownParent","isValidElement","push","render","call","ref","Component","defaultProps","renderOption","renderSelected","modules"],"mappings":"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","file":"SimpleSelect.js","sourcesContent":["import React from 'react';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport { createComponent } from 'webiny-app';\nimport ReactDOMServer from 'react-dom/server';\n\n\nclass SimpleSelect extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        this.select2 = null;\n        this.options = null;\n        ['getConfig', 'getValue', 'triggerChange', 'getSelect2InputElement', 'itemRenderer', 'getCurrentData', 'getPreviousData'].map(m => this[m] = this[m].bind(this));\n    }\n\n    componentDidMount() {\n        this.instantiate();\n    }\n\n    componentWillReceiveProps(props) {\n        if (props.value !== this.props.value) {\n            this.previousData = _.clone(this.getCurrentData());\n        }\n    }\n\n    componentDidUpdate() {\n        this.instantiate();\n        const possibleValues = _.map(this.options, obj => obj.id.toString());\n        const value = this.getValue();\n        const inPossibleValues = possibleValues.indexOf(value) > -1;\n\n        if (!this.options || !_.isEqual(this.props.options, this.options)) {\n            this.select2.empty();\n            this.getSelect2InputElement().select2(this.getConfig(this.props));\n            setTimeout(() => {\n                this.select2.val(this.getValue()).trigger('change');\n            }, 100);\n        }\n\n        $(this.dom).find('select').prop('disabled', !!this.props.disabled);\n\n        if (value !== null && !inPossibleValues && possibleValues.length > 0) {\n            this.triggerChange(null);\n            return;\n        }\n\n        if (value !== null && inPossibleValues) {\n            this.select2.val(value).trigger('change');\n            return;\n        }\n\n        // Select first value if model is empty and \"autoSelectFirstOptionOption\" is enabled\n        if (value === null && this.props.autoSelectFirstOption) {\n            const firstValue = _.get(this.props.options, '0.id');\n            if (firstValue) {\n                this.triggerChange(firstValue);\n            }\n            return;\n        }\n\n        this.select2.val('').trigger('change');\n    }\n\n    instantiate() {\n        if (!this.select2) {\n            this.select2 = this.getSelect2InputElement().select2(this.getConfig(this.props));\n            this.select2.on('select2:select', e => {\n                this.triggerChange(e.target.value);\n            });\n            this.select2.on('select2:unselect', () => {\n                this.triggerChange(null);\n            });\n            this.select2.val(this.getValue()).trigger('change');\n\n            if (this.props.dropdownClassName) {\n                setTimeout(() => this.select2.data('select2').$dropdown.addClass(this.props.dropdownClassName));\n            }\n        }\n    }\n\n    getSelect2InputElement() {\n        return $(this.dom).find('select');\n    }\n\n    getValue() {\n        const value = this.props.value;\n        if (value === null || value === undefined) {\n            return value;\n        }\n\n        return _.isObject(value) ? value.id : '' + value;\n    }\n\n    getCurrentData() {\n        if (this.props.useDataAsValue) {\n            return this.props.value;\n        }\n\n        let data = null;\n        const option = _.find(this.options, { id: this.props.value });\n        if (option) {\n            data = option.data;\n        }\n\n        return this.props.value ? data : null;\n    }\n\n    getPreviousData() {\n        return this.previousData;\n    }\n\n    triggerChange(value) {\n        if (this.props.useDataAsValue && value) {\n            const selectedOption = _.find(this.options, { id: value });\n            if (!selectedOption.data) {\n                console.warn('Warning: attempting to use item data but data is not present in option items!');\n            } else {\n                value = selectedOption.data;\n            }\n        }\n\n        // Save previous selection data so it can be accessed from onChange handlers\n        const prevValue = this.getValue();\n        if (this.props.useDataAsValue) {\n            this.previousData = prevValue ? _.clone(prevValue) : null;\n        } else {\n            let data = null;\n            const option = _.find(this.options, { id: prevValue });\n            if (option) {\n                data = option.data;\n            }\n            this.previousData = data ? _.clone(data) : null;\n        }\n        this.props.onChange(value);\n    }\n\n    getOptionText(text) {\n        if (!text) {\n            return '';\n        }\n\n        if (text.startsWith('<')) {\n            return $(text);\n        }\n\n        return text || '';\n    }\n\n    /**\n     * This will be triggered twice due to a bug in Select2 (https://github.com/select2/select2/pull/4306)\n     * @param item\n     * @param type renderOption || renderSelected\n     * @returns {*}\n     */\n    itemRenderer(item, type) {\n        let text = item.text;\n        if (_.isFunction(this.props[type]) && item.id) {\n            text = this.props[type]({ option: item || {} });\n        }\n\n        if (text && !_.isString(text)) {\n            text = ReactDOMServer.renderToStaticMarkup(text);\n        }\n\n        return this.getOptionText(text);\n    }\n\n    getConfig(props) {\n        const config = {\n            disabled: props.disabled,\n            minimumResultsForSearch: props.minimumResultsForSearch,\n            minimumInputLength: props.minimumInputLength,\n            placeholder: props.placeholder,\n            allowClear: props.allowClear,\n            templateResult: item => this.itemRenderer(item, 'renderOption'),\n            templateSelection: item => this.itemRenderer(item, 'renderSelected')\n        };\n\n        if (_.isFunction(this.props.matcher)) {\n            config.matcher = (params, data) => {\n                const term = (params.term || '').trim();\n                if (!term || term.length === 0) {\n                    return data;\n                }\n                return this.props.matcher({ term, option: data });\n            };\n        }\n\n        if (this.props.dropdownParent) {\n            config['dropdownParent'] = $(this.dom).find(props.dropdownParent);\n        }\n\n        if (!this.options || !_.isEqual(props.options, this.options) || !this.select2) {\n            // Prepare options\n            const options = [];\n            _.each(props.options, option => {\n                if (React.isValidElement(option.text)) {\n                    option.text = ReactDOMServer.renderToStaticMarkup(option.text);\n                }\n                options.push(option);\n            });\n            config['data'] = this.options = options;\n        }\n\n        return config;\n    }\n\n    render() {\n        if (this.props.render) {\n            return this.props.render.call(this);\n        }\n\n        return (\n            <div className=\"inputGroup\" ref={ref => this.dom = ref}>\n                <select style={{ 'width': '100%' }}/>\n\n                <div className=\"dropdown-wrapper\"/>\n            </div>\n        );\n    }\n}\n\nSimpleSelect.defaultProps = {\n    value: null,\n    allowClear: false,\n    autoSelectFirstOption: false,\n    placeholder: null,\n    onChange: _.noop,\n    minimumInputLength: 0,\n    minimumResultsForSearch: 15,\n    useDataAsValue: false,\n    dropdownParent: '.dropdown-wrapper',\n    dropdownClassName: null,\n    renderOption: null,\n    renderSelected: null,\n    matcher: null\n};\n\nexport default createComponent(SimpleSelect, {\n    modules: ['Vendor.Select2']\n});"]}