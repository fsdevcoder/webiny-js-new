{"version":3,"sources":["../../../src/components/CodeEditor/index.js"],"names":["CodeEditor","props","state","delayedOnChange","codeMirror","options","lineNumbers","htmlMode","mode","theme","readOnly","textarea","getTextareaElement","bind","setValue","attachToForm","CodeMirror","fromTextArea","on","clearTimeout","setTimeout","onChange","getValue","delay","onFocus","height","setSize","checkProps","prop","setOption","value","autoFormat","totalLines","lineCount","autoFormatRange","line","ch","render","call","ref","editor","onBlur","validate","className","placeholder","styles","FormGroup","isValid","renderLabel","wrapper","renderDescription","renderValidationMessage","Component","defaultProps","modules"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\nimport _ from 'lodash';\nimport classSet from \"classnames\";\nimport { createComponent } from 'webiny-app';\nimport { FormComponent } from 'webiny-app-ui';\nimport styles from './styles.css';\n\nclass CodeEditor extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {};\n\n        this.delayedOnChange = null;\n        this.codeMirror = null;\n        this.options = {\n            lineNumbers: true,\n            htmlMode: true,\n            mode: props.mode, // needs to be built into CodeMirror vendor\n            theme: props.theme, // needs to be built into CodeMirror vendor\n            readOnly: props.readOnly\n        };\n\n        this.textarea = null;\n        this.getTextareaElement = this.getTextareaElement.bind(this);\n        this.setValue = this.setValue.bind(this);\n    }\n\n    componentDidMount() {\n        if (this.props.attachToForm) {\n            this.props.attachToForm(this);\n        }\n\n        this.codeMirror = this.props.CodeMirror.fromTextArea(this.getTextareaElement(), this.options);\n\n        this.codeMirror.on('change', () => {\n            clearTimeout(this.delayedOnChange);\n            this.delayedOnChange = setTimeout(() => {\n                this.props.onChange(this.codeMirror.getValue());\n            }, this.props.delay);\n        });\n\n        this.codeMirror.on('focus', () => {\n            this.props.onFocus();\n        });\n\n        if (this.props.height !== null) {\n            this.codeMirror.setSize(null, this.props.height);\n        }\n\n        this.setValue(this.props);\n    }\n\n    componentWillReceiveProps(props) {\n        this.setValue(props);\n\n        const checkProps = ['mode', 'readOnly'];\n        _.each(checkProps, (prop) => {\n            if (this.props[prop] !== props[prop]) {\n                this.codeMirror.setOption(prop, props[prop]);\n            }\n        });\n    }\n\n    shouldComponentUpdate(props, state) {\n        return !_.isEqual(state, this.state);\n    }\n\n    setValue(props) {\n        if (this.codeMirror.getValue() !== props.value && !_.isNull(props.value)) {\n            // the \"+ ''\" sort a strange with splitLines method within CodeMirror\n            this.codeMirror.setValue(props.value + '');\n            if (this.props.autoFormat) {\n                this.autoFormat();\n            }\n        }\n    }\n\n    getTextareaElement() {\n        return this.textarea;\n    }\n\n    autoFormat() {\n        let totalLines = this.codeMirror.lineCount();\n        this.codeMirror.autoFormatRange({ line: 0, ch: 0 }, { line: totalLines });\n    }\n\n    render() {\n        if (this.props.render) {\n            return this.props.render.call(this);\n        }\n\n        const props = _.pick(this.props, ['value', 'onChange', 'onFocus', 'theme', 'mode', 'readOnly']);\n\n        _.assign(props, {\n            ref: editor => this.editor = editor,\n            onBlur: this.props.validate,\n            className: 'inputGroup',\n            placeholder: this.props.placeholder\n        });\n\n        const { styles, FormGroup } = this.props;\n\n        return (\n            <FormGroup valid={this.state.isValid} className={classSet(this.props.className)}>\n                {this.props.renderLabel.call(this)}\n                <div className={styles.wrapper}>\n                    <textarea ref={ref => this.textarea = ref}/>\n                </div>\n                <div>\n                    {this.props.renderDescription.call(this)}\n                    {this.props.renderValidationMessage.call(this)}\n                </div>\n            </FormGroup>\n        );\n    }\n}\n\nCodeEditor.defaultProps = {\n    delay: 400,\n    mode: 'text/html',\n    theme: 'monokai',\n    readOnly: false, // set 'nocursor' to disable cursor\n    onFocus: _.noop,\n    value: null,\n    onChange: _.noop,\n    height: null,\n    autoFormat: false\n};\n\nexport default createComponent([CodeEditor, FormComponent], {\n    styles,\n    modules: ['FormGroup', { CodeMirror: 'Vendor.CodeMirror' }]\n});"]}