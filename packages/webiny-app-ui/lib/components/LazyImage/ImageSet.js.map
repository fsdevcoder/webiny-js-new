{"version":3,"sources":["../../../src/components/LazyImage/ImageSet.jsx"],"names":["ImageSet","props","dom","interval","images","map","m","bind","getImages","querySelectorAll","img","hasAttribute","rect","getBoundingClientRect","setAttribute","top","push","length","setInterval","checkOffset","offset","window","scrollY","innerHeight","getAttribute","clearInterval","children","render","call","isValidElement","ref","Component","defaultProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AAEA;;;;IAEMA,Q;;;AACF,sBAAYC,KAAZ,EAAmB;AAAA;;AAAA,sIACTA,KADS;;AAGf,cAAKC,GAAL,GAAW,IAAX;AACA,cAAKC,QAAL,GAAgB,IAAhB;AACA,cAAKC,MAAL,GAAc,EAAd;;AAEA,SAAC,wBAAD,EAA2BC,GAA3B,CAA+B;AAAA,mBAAK,MAAKC,CAAL,IAAU,MAAKA,CAAL,EAAQC,IAAR,OAAf;AAAA,SAA/B;AAPe;AAQlB;;;;4CAEmB;AAChB,iBAAKC,SAAL;AACH;;;oCAEW;AAAA;;AACR,gCAAO,KAAKN,GAAL,CAASO,gBAAT,CAA0B,KAA1B,CAAP,EAAyC,eAAO;AAC5C,oBAAIC,IAAIC,YAAJ,CAAiB,UAAjB,CAAJ,EAAkC;AAC9B,wBAAMC,OAAOF,IAAIG,qBAAJ,EAAb;AACAH,wBAAII,YAAJ,CAAiB,QAAjB,EAA2BF,KAAKG,GAAhC;AACA,2BAAKX,MAAL,CAAYY,IAAZ,CAAiBN,GAAjB;AACH;AACJ,aAND;;AAQA,gBAAI,KAAKN,MAAL,CAAYa,MAAZ,GAAqB,CAAzB,EAA4B;AACxB,qBAAKd,QAAL,GAAgBe,YAAY,KAAKC,WAAjB,EAA8B,GAA9B,CAAhB;AACH;AACJ;;;sCAEa;AACV,gBAAMC,SAASC,OAAOC,OAAP,GAAiBD,OAAOE,WAAxB,GAAsC,KAAKtB,KAAL,CAAWmB,MAAhE;;AAEA,gBAAMhB,SAAS,EAAf;AACA,iBAAKA,MAAL,CAAYC,GAAZ,CAAgB,eAAO;AACnB,oBAAIe,UAAUV,IAAIc,YAAJ,CAAiB,QAAjB,CAAd,EAA0C;AACtCd,wBAAII,YAAJ,CAAiB,KAAjB,EAAwBJ,IAAIc,YAAJ,CAAiB,UAAjB,CAAxB;AACH,iBAFD,MAEO;AACHpB,2BAAOY,IAAP,CAAYN,GAAZ;AACH;AACJ,aAND;;AAQA,iBAAKN,MAAL,GAAcA,MAAd;AACA,gBAAIA,OAAOa,MAAP,IAAiB,CAArB,EAAwB;AACpBQ,8BAAc,KAAKtB,QAAnB;AACA,qBAAKA,QAAL,GAAgB,IAAhB;AACH;AACJ;;;iCAEQ;AAAA;;AAAA,yBACwB,KAAKF,KAD7B;AAAA,gBACGyB,QADH,UACGA,QADH;AAAA,gBACaC,MADb,UACaA,MADb;;;AAGL,gBAAIA,MAAJ,EAAY;AACR,uBAAOA,OAAOC,IAAP,CAAY,IAAZ,CAAP;AACH;;AAED,mBAAO,gBAAMC,cAAN,CAAqBH,QAArB,IAAiCA,QAAjC,GACH;AAAA;AAAA,kBAAkB,KAAK;AAAA,+BAAO,OAAKxB,GAAL,GAAW4B,IAAlB;AAAA,qBAAvB;AAA+CJ;AAA/C,aADJ;AAGH;;;EA1DkB,gBAAMK,S;;AA6D7B/B,SAASgC,YAAT,GAAwB;AACpBZ,YAAQ;AADY,CAAxB;;kBAIe,gCAAgBpB,QAAhB,C","file":"ImageSet.js","sourcesContent":["import React from 'react';\nimport _ from 'lodash';\nimport { createComponent } from 'webiny-app';\n\nclass ImageSet extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.dom = null;\n        this.interval = null;\n        this.images = [];\n\n        ['getImages, checkOffset'].map(m => this[m] = this[m].bind(this));\n    }\n\n    componentDidMount() {\n        this.getImages();\n    }\n\n    getImages() {\n        _.each(this.dom.querySelectorAll('img'), img => {\n            if (img.hasAttribute('data-src')) {\n                const rect = img.getBoundingClientRect();\n                img.setAttribute('offset', rect.top);\n                this.images.push(img);\n            }\n        });\n\n        if (this.images.length > 0) {\n            this.interval = setInterval(this.checkOffset, 500);\n        }\n    }\n\n    checkOffset() {\n        const offset = window.scrollY + window.innerHeight + this.props.offset;\n\n        const images = [];\n        this.images.map(img => {\n            if (offset >= img.getAttribute('offset')) {\n                img.setAttribute('src', img.getAttribute('data-src'));\n            } else {\n                images.push(img);\n            }\n        });\n\n        this.images = images;\n        if (images.length <= 0) {\n            clearInterval(this.interval);\n            this.interval = null;\n        }\n    }\n\n    render() {\n        const { children, render } = this.props;\n\n        if (render) {\n            return render.call(this);\n        }\n\n        return React.isValidElement(children) ? children : (\n            <webiny-image-set ref={ref => this.dom = ref}>{children}</webiny-image-set>\n        );\n    }\n}\n\nImageSet.defaultProps = {\n    offset: 0\n};\n\nexport default createComponent(ImageSet);\n"]}