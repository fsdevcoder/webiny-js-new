{"version":3,"sources":["../../../src/components/Downloader/index.js"],"names":["Downloader","props","state","downloaded","download","bind","downloader","submit","onReady","httpMethod","url","params","setState","f","render","call","action","startsWith","defaults","baseURL","value","name","map","v","index","push","authorization","ref","Component","defaultProps","tokenCookie"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AAEA;;;;AACA;;;;IAEMA,U;;;AACF,wBAAYC,KAAZ,EAAmB;AAAA;;AAAA,0IACTA,KADS;;AAGf,cAAKC,KAAL,GAAa,EAAb;AACA,cAAKC,UAAL,GAAkB,IAAlB;;AAEA,cAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcC,IAAd,OAAhB;AANe;AAOlB;;;;6CAEoB;AACjB,iBAAKC,UAAL,IAAmB,KAAKA,UAAL,CAAgBC,MAAhB,EAAnB;AACH;;;4CAEmB;AAChB,gBAAI,KAAKN,KAAL,CAAWO,OAAf,EAAwB;AACpB,qBAAKP,KAAL,CAAWO,OAAX,CAAmB;AACfJ,8BAAU,KAAKA;AADA,iBAAnB;AAGH;AACJ;;;iCAEQK,U,EAAYC,G,EAAoB;AAAA,gBAAfC,MAAe,uEAAN,IAAM;;AACrC,iBAAKR,UAAL,GAAkB,KAAlB;AACA,iBAAKS,QAAL,CAAc,EAAEH,sBAAF,EAAcC,QAAd,EAAmBC,QAAQ,sBAASA,MAAT,EAAiB;AAAA,2BAAK,CAAC,2BAAcE,CAAd,CAAN;AAAA,iBAAjB,CAA3B,EAAd;AACH;;;iCAEQ;AAAA;;AACL,gBAAI,KAAKZ,KAAL,CAAWa,MAAf,EAAuB;AACnB,uBAAO,KAAKb,KAAL,CAAWa,MAAX,CAAkBC,IAAlB,CAAuB,IAAvB,CAAP;AACH;;AAED,gBAAI,KAAKZ,UAAT,EAAqB;AACjB,uBAAO,IAAP;AACH;;AAED,gBAAIa,SAAS,KAAKd,KAAL,CAAWQ,GAAxB;AACA,gBAAI,CAACM,OAAOC,UAAP,CAAkB,MAAlB,CAAL,EAAgC;AAC5BD,yBAAS,gBAAME,QAAN,CAAeC,OAAf,GAAyBH,MAAlC;AACH;;AAED,gBAAIL,SAAS,IAAb;AACA,gBAAI,KAAKT,KAAL,CAAWS,MAAf,EAAuB;AACnBA,yBAAS,EAAT;AACA,oCAAO,KAAKT,KAAL,CAAWS,MAAlB,EAA0B,UAACS,KAAD,EAAQC,IAAR,EAAiB;AACvC,wBAAI,uBAAUD,KAAV,CAAJ,EAAsB;AAClBA,8BAAME,GAAN,CAAU,UAACC,CAAD,EAAIC,KAAJ,EAAc;AACpBb,mCAAOc,IAAP,CACI;AACI,sCAAK,QADT;AAEI,sCAAMJ,OAAO,IAFjB;AAGI,uCAAOE,CAHX;AAII,qCAAKF,OAAO,GAAP,GAAaG;AAJtB,8BADJ;AAQH,yBATD;AAUA;AACH;AACDb,2BAAOc,IAAP,CAAY,yCAAO,MAAK,QAAZ,EAAqB,MAAMJ,IAA3B,EAAiC,OAAOD,KAAxC,EAA+C,KAAKC,IAApD,GAAZ;AACH,iBAfD;AAgBH;;AAED,gBAAIK,gBAAgB,IAApB;AACA,gBAAI,KAAKxB,KAAL,CAAWO,UAAX,KAA0B,KAA9B,EAAqC;AACjC;AACA;;;AAGH;;AAED,iBAAKN,UAAL,GAAkB,IAAlB;;AAEA,mBACI;AAAA;AAAA;AACI,yBAAK;AAAA,+BAAQ,OAAKG,UAAL,GAAkBqB,IAA1B;AAAA,qBADT;AAEI,4BAAQX,MAFZ;AAGI,4BAAQ,KAAKd,KAAL,CAAWO,UAHvB;AAII,4BAAO;AAJX;AAMKE,sBANL;AAOKe;AAPL,aADJ;AAWH;;;EAnFoB,gBAAME,S;;AAsF/B5B,WAAW6B,YAAX,GAA0B;AACtBC,iBAAa,cADS;AAEtBtB;AAFsB,CAA1B;;kBAKe,gCAAgBR,UAAhB,C","file":"index.js","sourcesContent":["import React from \"react\";\nimport _ from \"lodash\";\nimport axios from \"axios\";\nimport { createComponent } from \"webiny-app\";\n\nclass Downloader extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {};\n        this.downloaded = true;\n\n        this.download = this.download.bind(this);\n    }\n\n    componentDidUpdate() {\n        this.downloader && this.downloader.submit();\n    }\n\n    componentDidMount() {\n        if (this.props.onReady) {\n            this.props.onReady({\n                download: this.download\n            });\n        }\n    }\n\n    download(httpMethod, url, params = null) {\n        this.downloaded = false;\n        this.setState({ httpMethod, url, params: _.pickBy(params, f => !_.isUndefined(f)) });\n    }\n\n    render() {\n        if (this.props.render) {\n            return this.props.render.call(this);\n        }\n\n        if (this.downloaded) {\n            return null;\n        }\n\n        let action = this.state.url;\n        if (!action.startsWith(\"http\")) {\n            action = axios.defaults.baseURL + action;\n        }\n\n        let params = null;\n        if (this.state.params) {\n            params = [];\n            _.each(this.state.params, (value, name) => {\n                if (_.isArray(value)) {\n                    value.map((v, index) => {\n                        params.push(\n                            <input\n                                type=\"hidden\"\n                                name={name + \"[]\"}\n                                value={v}\n                                key={name + \"-\" + index}\n                            />\n                        );\n                    });\n                    return;\n                }\n                params.push(<input type=\"hidden\" name={name} value={value} key={name} />);\n            });\n        }\n\n        let authorization = null;\n        if (this.state.httpMethod !== \"GET\") {\n            // TODO: after security\n            /*authorization = (\n                <input type=\"hidden\" name=\"Authorization\" value={Webiny.Cookies.get(this.props.tokenCookie)}/>\n            );*/\n        }\n\n        this.downloaded = true;\n\n        return (\n            <form\n                ref={ref => (this.downloader = ref)}\n                action={action}\n                method={this.state.httpMethod}\n                target=\"_blank\"\n            >\n                {params}\n                {authorization}\n            </form>\n        );\n    }\n}\n\nDownloader.defaultProps = {\n    tokenCookie: \"webiny-token\",\n    onReady: _.noop\n};\n\nexport default createComponent(Downloader);\n"]}