{"version":3,"sources":["../../../src/components/GoogleMap/index.js"],"names":["GoogleMap","props","state","initialState","dom","map","marker","geoCoder","loading","m","bind","attachToForm","window","google","loadScript","apiKey","then","setupMap","onReady","search","positionMarker","newProps","value","lat","center","lng","maps","Map","LatLng","parseFloat","zoom","mapTypeId","MapTypeId","ROADMAP","Marker","draggable","readOnly","event","addListener","onChange","getPosition","latLng","panTo","setMap","setPosition","query","Geocoder","geocode","address","results","location","render","call","styles","container","style","ref","children","Component","defaultProps","formComponent"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport _ from 'lodash';\nimport { createComponent, document } from 'webiny-app';\nimport { FormComponent } from 'webiny-app';\nimport styles from './styles.css';\n\n// TODO: https://www.npmjs.com/package/react-google-maps\n\nclass GoogleMap extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            ...props.initialState\n        };\n\n        this.dom = null;\n        this.map = null;\n        this.marker = null;\n        this.geoCoder = null;\n        this.loading = null;\n\n        ['positionMarker', 'setupMap', 'search'].map(m => this[m] = this[m].bind(this));\n    }\n\n    componentDidMount() {\n        if (this.props.attachToForm) {\n            this.props.attachToForm(this);\n        }\n\n        if (!window.google) {\n            return document.loadScript('https://maps.googleapis.com/maps/api/js?key=' + this.props.apiKey).then(() => {\n                this.setupMap();\n            });\n        }\n\n        if (this.props.onReady) {\n            this.props.onReady({\n                search: this.search,\n                positionMarker: this.positionMarker\n            });\n        }\n\n        this.setupMap();\n    }\n\n    shouldComponentUpdate(newProps) {\n        if (!newProps.value) {\n            return false;\n        }\n\n        return !_.isEqual(this.props.value, newProps.value);\n    }\n\n    componentDidUpdate() {\n        if (!this.map) {\n            return;\n        }\n\n        this.positionMarker();\n    }\n\n    setupMap() {\n        const lat = _.get(this.props, 'value.lat', this.props.center.lat);\n        const lng = _.get(this.props, 'value.lng', this.props.center.lng);\n\n        this.map = new google.maps.Map(this.dom, {\n            center: new google.maps.LatLng(parseFloat(lat), parseFloat(lng)),\n            zoom: this.props.zoom,\n            mapTypeId: google.maps.MapTypeId.ROADMAP\n        });\n\n        this.marker = new google.maps.Marker({\n            map: this.map,\n            draggable: true\n        });\n\n        if (!this.props.readOnly) {\n            google.maps.event.addListener(this.marker, 'dragend', () => {\n                this.props.onChange({\n                    lat: this.marker.getPosition().lat(),\n                    lng: this.marker.getPosition().lng()\n                });\n            });\n        }\n\n        this.positionMarker();\n    }\n\n    positionMarker() {\n        const lat = _.get(this.props, 'value.lat');\n        const lng = _.get(this.props, 'value.lng');\n\n        if (lat && lng) {\n            const latLng = new google.maps.LatLng(parseFloat(lat), parseFloat(lng));\n            this.map.panTo(latLng);\n            this.marker.setMap(this.map);\n            this.marker.setPosition(latLng);\n        }\n    }\n\n    search(query) {\n        if (!this.geoCoder) {\n            this.geoCoder = new google.maps.Geocoder();\n        }\n\n        this.geoCoder.geocode({ address: query }, results => {\n            if (!_.isEmpty(results)) {\n                const location = _.get(results[0], 'geometry.location');\n                this.props.onChange({\n                    lat: location.lat(),\n                    lng: location.lng()\n                });\n            }\n        });\n    }\n\n    render() {\n        if (this.props.render) {\n            return this.props.render.call(this);\n        }\n\n        const { styles } = this.props;\n        return (\n            <div className={styles.container} style={this.props.style}>\n                <div ref={ref =>this.dom = ref} className={styles.map}>{this.props.children}</div>\n            </div>\n        );\n    }\n}\n\nGoogleMap.defaultProps = {\n    apiKey: null,\n    zoom: 4,\n    center: {\n        lat: 0,\n        lng: 0\n    },\n    readOnly: false,\n    style: null,\n    value: null,\n    onChange: _.noop\n};\n\nexport default createComponent([GoogleMap, FormComponent], { styles, formComponent: true });"]}