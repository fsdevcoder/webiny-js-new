{"version":3,"sources":["../../src/endpoints/auth.js"],"names":["Auth","init","api","notAuthenticated","get","req","identity","toJSON","query","_fields","setPublic","patch","body","populate","save","classId","version"],"mappings":";;;;;;;;;;AACA;;;;AAGA,MAAMA,IAAN,6BAA4B;AACxBC,SAAKC,GAAL,EAAwB;AACpB,cAAMC,mBAAmB,gCACrB,EADqB,EAErB,4BAFqB,EAGrB,uBAHqB,EAIrB,GAJqB,CAAzB;;AAOA;;;AAGAD,YACKE,GADL,CACS,SADT,EACoB,KADpB;AAAA,uDAC2B,WAAO,EAAEC,GAAF,EAAP,EAAmB;AACtC,oBAAI,CAACA,IAAIC,QAAT,EAAmB;AACf,2BAAOH,gBAAP;AACH;AACD,uBAAO,4BAAgB,MAAME,IAAIC,QAAJ,CAAaC,MAAb,CAAoBF,IAAIG,KAAJ,CAAUC,OAA9B,CAAtB,EAAP;AACH,aANL;;AAAA;AAAA;AAAA;AAAA,cAOKC,SAPL;;AASAR,YACKS,KADL,CACW,gBADX,EAC6B,KAD7B;AAAA,wDACoC,WAAO,EAAEN,KAAK,EAAEC,QAAF,EAAYE,KAAZ,EAAmBI,IAAnB,EAAP,EAAP,EAA8C;AAC1E,oBAAI,CAACN,QAAL,EAAe;AACX,2BAAOH,gBAAP;AACH;;AAED,sBAAMG,SAASO,QAAT,CAAkBD,IAAlB,EAAwBE,IAAxB,EAAN;;AAEA,uBAAO,4BAAgB,MAAMR,SAASC,MAAT,CAAgBC,MAAMC,OAAtB,CAAtB,EAAP;AACH,aATL;;AAAA;AAAA;AAAA;AAAA,cAUKC,SAVL;AAWH;AAhCuB;;;AAmC5BV,KAAKe,OAAL,GAAe,yBAAf;AACAf,KAAKgB,OAAL,GAAe,OAAf;;kBAEehB,I","file":"auth.js","sourcesContent":["// @flow\nimport { ApiResponse, ApiErrorResponse, Endpoint } from \"webiny-api\";\nimport type { ApiContainer } from \"webiny-api\";\n\nclass Auth extends Endpoint {\n    init(api: ApiContainer) {\n        const notAuthenticated = new ApiErrorResponse(\n            {},\n            \"You are not authenticated!\",\n            \"WBY_NOT_AUTHENTICATED\",\n            401\n        );\n\n        /**\n         * Identity profile\n         */\n        api\n            .get(\"Auth.Me\", \"/me\", async ({ req }) => {\n                if (!req.identity) {\n                    return notAuthenticated;\n                }\n                return new ApiResponse(await req.identity.toJSON(req.query._fields));\n            })\n            .setPublic();\n\n        api\n            .patch(\"Auth.Me.Update\", \"/me\", async ({ req: { identity, query, body } }) => {\n                if (!identity) {\n                    return notAuthenticated;\n                }\n\n                await identity.populate(body).save();\n\n                return new ApiResponse(await identity.toJSON(query._fields));\n            })\n            .setPublic();\n    }\n}\n\nAuth.classId = \"Security.Authentication\";\nAuth.version = \"1.0.0\";\n\nexport default Auth;\n"]}